---
import { getEntry } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout/index.astro";
import SectionTop from "../../components/SectionTop/index.astro";
import SectionHeader from "../../components/SectionHeader/index.astro"
import ServiceList from "../../components/ServiceList/index.astro";
import type { IPageData } from "../../utils/types";

export async function getStaticPaths() {
  const page = await getEntry("pages", "services");
  if (!page) throw new Error("Services page not found");
  
  const { services } = page.data as unknown as IPageData;
  
  return services.map((cat) => ({
    params: { slug: cat.propertyUrl.replace('/services/', '') },
    props: { category: cat }
  }));
}

const { category } = Astro.props;
---

<BaseLayout title={`${category.title} | Сервисный центр`}>
  <SectionTop>
    <SectionHeader heading={category.title} paragraph={category.description} haveButton=true pathUrl="/services"/>
    <ServiceList services={category.items} />
  </SectionTop>
</BaseLayout>